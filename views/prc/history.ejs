
<div class="row">
    <div class="col-12">
        <!-- Page Header -->
        <div class="d-flex align-items-center justify-content-between mb-4">
            <div class="d-flex align-items-center">
                <a href="/prc/dashboard" class="btn btn-outline-secondary me-3">
                    <i class="bi bi-arrow-left"></i>
                </a>
                <div>
                    <h3 class="mb-0">
                        <i class="bi bi-<%= user.role === 'citizen' || user.role === 'user' ? 'folder-fill' : 'clock-history' %> me-2"></i>
                        <%= title %>
                    </h3>
                    <small class="text-muted">
                        <%= prcs.length %> <%= prcs.length === 1 ? 'document' : 'documents' %>
                    </small>
                </div>
            </div>
            <% if (user.role !== 'citizen' && user.role !== 'user') { %>
                <a href="/prc/create" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-2"></i>Generate New PRC
                </a>
            <% } %>
        </div>

        <!-- PRC List -->
        <% if (prcs.length > 0) { %>
            <div class="row">
                <% prcs.forEach(prc => { %>
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100 <%= prc.isRevoked ? 'border-danger' : prc.isValid ? 'border-success' : 'border-warning' %>">
                            <div class="card-header <%= prc.isRevoked ? 'bg-danger text-white' : prc.isValid ? 'bg-success text-white' : 'bg-warning text-dark' %>">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="bi bi-file-earmark-text me-1"></i>
                                        <strong><%= prc.prcData.gn %> <%= prc.prcData.fn %></strong>
                                    </div>
                                    <span class="badge bg-<%= prc.isRevoked ? 'dark' : prc.isValid ? 'light' : 'secondary' %> text-<%= prc.isRevoked || prc.isValid ? 'dark' : 'white' %>">
                                        <%= prc.prcData.ic %>
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <dl class="row small mb-2">
                                    <dt class="col-5">Personal ID:</dt>
                                    <dd class="col-7"><code class="small"><%= prc.prcData.hi %></code></dd>

                                    <dt class="col-5">Institution:</dt>
                                    <dd class="col-7"><%= prc.prcData.in %> (<%= prc.prcData.ii %>)</dd>

                                    <dt class="col-5">Validity:</dt>
                                    <dd class="col-7">
                                        <%= new Date(prc.prcData.sd).toLocaleDateString() %><br>
                                        <small class="text-muted">to <%= new Date(prc.prcData.ed).toLocaleDateString() %></small>
                                    </dd>

                                    <dt class="col-5">Issued:</dt>
                                    <dd class="col-7"><%= new Date(prc.prcData.di).toLocaleDateString() %></dd>

                                    <% if (user.role === 'citizen' || user.role === 'user') { %>
                                        <dt class="col-5">Generated by:</dt>
                                        <dd class="col-7">
                                            <% if (prc.generatedBy) { %>
                                                <%= prc.generatedBy.firstName %> <%= prc.generatedBy.lastName %>
                                            <% } else { %>
                                                <span class="text-muted">System</span>
                                            <% } %>
                                        </dd>
                                    <% } %>

                                    <dt class="col-5">Status:</dt>
                                    <dd class="col-7">
                                        <% if (prc.isRevoked) { %>
                                            <span class="badge bg-danger">
                                                <i class="bi bi-x-circle me-1"></i>Revoked
                                            </span>
                                        <% } else if (prc.isValid) { %>
                                            <span class="badge bg-success">
                                                <i class="bi bi-check-circle me-1"></i>Valid
                                            </span>
                                        <% } else if (prc.isExpired) { %>
                                            <span class="badge bg-warning text-dark">
                                                <i class="bi bi-exclamation-triangle me-1"></i>Expired
                                            </span>
                                        <% } else { %>
                                            <span class="badge bg-secondary">
                                                <i class="bi bi-clock me-1"></i><%= prc.status %>
                                            </span>
                                        <% } %>
                                    </dd>
                                </dl>

                                <% if (prc.isRevoked && prc.revocationReason) { %>
                                    <div class="alert alert-danger py-2 px-2 small mb-2">
                                        <strong>Revoked:</strong> <%= prc.revocationReason %>
                                    </div>
                                <% } %>

                                <% if (prc.emailSent) { %>
                                    <div class="alert alert-info py-2 px-2 small mb-2">
                                        <i class="bi bi-envelope-check me-1"></i>
                                        Sent to <%= prc.emailRecipient %> on <%= new Date(prc.emailSentAt).toLocaleDateString() %>
                                    </div>
                                <% } %>
                            </div>
                            <div class="card-footer bg-light">
                                <div class="d-flex gap-2">
                                    <a href="/prc/<%= prc._id %>" class="btn btn-outline-primary btn-sm flex-fill">
                                        <i class="bi bi-eye me-1"></i>View
                                    </a>
                                    <% if (prc.pdfBuffer) { %>
                                        <a href="/prc/<%= prc._id %>/download" class="btn btn-outline-success btn-sm flex-fill">
                                            <i class="bi bi-download me-1"></i>PDF
                                        </a>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <!-- Empty State -->
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="bi bi-folder2-open" style="font-size: 4rem; opacity: 0.3;"></i>
                    <h4 class="mt-3 text-muted">No documents found</h4>
                    <% if (user.role === 'citizen' || user.role === 'user') { %>
                        <p class="text-muted">
                            You haven't received any PRC documents yet.<br>
                            Request a PRC from your dashboard when you need one for travel.
                        </p>
                        <a href="/prc/create" class="btn btn-primary mt-3">
                            <i class="bi bi-plus-circle me-2"></i>Request PRC
                        </a>
                    <% } else { %>
                        <p class="text-muted">
                            You haven't generated any PRC documents yet.<br>
                            Start by creating your first PRC.
                        </p>
                        <a href="/prc/create" class="btn btn-primary mt-3">
                            <i class="bi bi-plus-circle me-2"></i>Generate New PRC
                        </a>
                    <% } %>
                </div>
            </div>
        <% } %>

        <!-- Statistics Summary (if there are documents) -->
        <% if (prcs.length > 0) { %>
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <i class="bi bi-bar-chart me-2"></i>
                    Summary
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h4 class="text-primary"><%= prcs.length %></h4>
                            <p class="text-muted mb-0 small">Total Documents</p>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-success"><%= prcs.filter(p => p.isValid).length %></h4>
                            <p class="text-muted mb-0 small">Currently Valid</p>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-warning"><%= prcs.filter(p => p.isExpired).length %></h4>
                            <p class="text-muted mb-0 small">Expired</p>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-danger"><%= prcs.filter(p => p.isRevoked).length %></h4>
                            <p class="text-muted mb-0 small">Revoked</p>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>
